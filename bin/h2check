#!/usr/bin/env node

var util = require('util'),
    path = require('path'),
    spawn = require('child_process').spawn;

var argv = require('commander')
  .option('-p, --port <value>', 'target port', 80)
  .option('-h, --host <value>', 'target host', '127.0.0.1')
  .parse(process.argv);

var processArgs = [
  path.resolve(__dirname, '../node_modules/.bin/_mocha')
];

var port = argv.port;
var host = argv.host;

process.env.H2CHECK_PORT = port;
process.env.H2CHECK_HOST = host;

var proc = spawn(process.argv[0], processArgs, { customFds: [0,1,2] });
proc.on('exit', function (code, signal) {
  process.on('exit', function(){
    if (signal) {
      process.kill(process.pid, signal);
    } else {
      process.exit(code);
    }
  });
});
